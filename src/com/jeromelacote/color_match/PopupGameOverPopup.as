package com.jeromelacote.color_match{	import caurina.transitions.*;		import com.jeromelacote.color_match.PopupEvent;	import com.jeromelacote.mylib.FileUtilities;	import com.jeromelacote.mylib.UIEventDispatcher;		import flash.display.MovieClip;	import flash.events.MouseEvent;	import flash.events.NetStatusEvent;	import flash.net.SharedObject;	import flash.net.SharedObjectFlushStatus;		public class PopupGameOverPopup extends PopupGameOverPopup_mc	{				//public var so:SharedObject = SharedObject.getLocal("colorMatchObject");		public var storedScore:Number;		public var mydata:FileUtilities=new FileUtilities();				public function PopupGameOverPopup() 		{			this.alpha=0;			Tweener.addTween(this,{alpha:1,time:.1,delay:1.5,transition:'easeOutCubic'});			btn_replay.addEventListener(MouseEvent.CLICK, onClick);			btn_replay.label_txt.text="NEXT LEVEL";			btn_replay.buttonMode=true;						btn_levelselect.addEventListener(MouseEvent.CLICK, onClick);			btn_levelselect.label_txt.text="BACK HOME";				btn_levelselect.buttonMode=true;						UIEventDispatcher.INSTANCE.addEventListener(PopupEvent.ON_SETDATA, onSetData);		}						public function onSetData(e:PopupEvent) 		{		//trace ("poup said."+e.data[0]);		//trace ("poup said."+e.data[1]);			//trace ("poup said."+e.data[2]);		var level=e.data[3];		var difficulty=StorageManager.instance.difficulty;		var error=e.data[2]+1;		var bestscore:Number=0;		var duration=e.data[0];				var score:Number=Math.floor(( 10 *(100/(error+1))*(100000/duration))*(level/2)*(difficulty*difficulty/2));		score= Math.floor(score/10)*10;		if((score<0)||(isNaN(score) )){score=0;}		time_txt.text=(e.data[1]).toString();		error_txt.text=(error).toString();			score_txt.text=(score).toString();		level_txt.text="You are at Level "+level;		title_txt.text="GOOD JOB";		bestscore_label.text="BEST SCORE:";				storedScore=StorageManager.instance.topScore; //Number(mydata.Read("StoreScore"));		trace ("topScore> "+ storedScore);		trace ("Score> "+ score);				if(storedScore==1){			storedScore=score;			bestscore_label.text="YOU SET THE BEST SCORE:";			title_txt.text="GOOD START"		}else{						if(score>storedScore){				storedScore=score;				trace("you have the best score");				bestscore_label.text="YOU SET THE BEST SCORE:";				title_txt.text="AWESOME!!!"			}				}		StorageManager.instance.topScore=storedScore;		StorageManager.instance.writeSaveData()		//mydata.Write("StoreScore",storedScore.toString());		bestscore=storedScore;		bestscore_txt.text=(bestscore).toString();				/////////////////////////////game win condition		if(level==9){			btn_replay.visible=false;			level_txt.htmlText="You unlocked all the levels <br/> Try a different difficulty!"					}				}					public function onClick(e:MouseEvent) 		{			//trace ("h0"+e.target);						if(e.target==btn_replay){				trace ("btn_replay");				var revt:PopupEvent = new PopupEvent( PopupEvent.ON_PLAYNEXTLEVEL );				UIEventDispatcher.INSTANCE.dispatchEvent(revt);			}						if(e.target==btn_levelselect){				trace ("btn_levelselect");				var evt:PopupEvent = new PopupEvent( PopupEvent.ON_BACK );				UIEventDispatcher.INSTANCE.dispatchEvent(evt);			}						parent.removeChild(this);		}					}}